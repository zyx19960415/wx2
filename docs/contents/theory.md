## 实现思路

>  举个例子，拿生产手机的流水线来说，所有手机的生产流程都是一致的，不管是生成 iphoneX（转微信小程序） 还是 华为P30（转百度小程序），只要给流水线提供零件（转换规则）并且遵循这套标准规则（转换流程）就可以得到想要的结果。
>  如果后续需要生成 其他牌子的手机（转支付宝小程序或其他小程序），也是如此。 扩展性和标准性有很显著的提升。

wx2的整体架构和实现思路主要分为6大部分：

 * 系统基础能力
 * 全流程的processor
 * 全局上下文
 * 公共转换规则
 * 日志输出
 * 插件中心

## 架构图

![图片](https://issuecdn.baidupcs.com/issue/netdisk/ts_ad/help/1582086033.png)

## 系统基础能力
利用babel，htmlparse，postcss等提供的AST解析和转译能力，完成小程序功能的抹平

## 全流程的processor

| 生命周期      |     说明 |      |
| :-------- | --------| :------ |
| bootstrap    |   复制文件，根据文件后缀进行映射 |  field3  |
| config    |   处理project.config.json文件 |  field3  |
| View    |   转换视图文件 |  field3  |
| css    |   转换css文件 |  field3  |
| js    |   转换filter或sjs文件 |  field3  |
| API    |   转换API |  field3  |

## 全局上下文

储存转换规则配置，转换类型，状态，用户自定义配置，全局数据，日志等。

## 公共转换规则

小程序间的差异会根据转换类型，比如微信转百度，百度转微信等划分为独立的规则配置，注入到context中

## 日志输出

日志部分分类为info，warning，error三种类型，统一进行可视化展示，渲染成html文件


## 插件中心

抽离插件，每个插件职责单一，只专注于当前阶段需要做的事情，无需关心规则。



